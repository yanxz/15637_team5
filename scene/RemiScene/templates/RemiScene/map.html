<!DOCTYPE html>
<html>
  <head>
    {% load static %}
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZSWHRKqyMc9_0-NZuHCNVHxyvQGHTOhk&sensor=true">
    </script>
    <script type="text/javascript" src="{% static 'js/markerclusterer.js' %}"></script>
    <script type="text/javascript">
      
      google.maps.event.addDomListener(window, 'load', function(){ getLocation(); });

      function addInfoWindow(marker, content) {
        var infowindow = new google.maps.InfoWindow({
            content: content,
            maxWidth: 200
          });

        google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map, marker);
          });
      }

      function randomInRange(min, max) {
        return Math.random() < 0.5 ? ((1-Math.random()) * (max-min) + min) : (Math.random() * (max-min) + min);
      }

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        }
      }

      function showPosition(position) {
        lat = position.coords.latitude;
        lng = position.coords.longitude;

        var mapOptions = {
          center: new google.maps.LatLng(lat, lng),
          zoom: 6
        };

        // Create the map
        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);

        var markers = [];
        {% for scene in scenes %}
          var latLng = new google.maps.LatLng({{ scene.loc_lat }}, {{ scene.loc_lng }});
          var marker = new google.maps.Marker({
            map: map,
            position: latLng,
          });
          var contentString = '<div><p>{{ scene.title }}</p>' + '<p>{{ scene.description }}</p>' + "<a href = \"" + "{% url 'scene_home' scene.id %}" +"\">" + 'Go to scene</a></div>';
          addInfoWindow(marker, contentString);

          markers.push(marker);
        {% endfor %}
        var markerCluster = new MarkerClusterer(map, markers);
      }
    </script>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>